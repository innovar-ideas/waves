generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                         String                      @id @default(uuid())
  active                     Boolean                     @default(true)
  email                      String?                     @unique
  first_name                 String
  last_name                  String
  password                   String?
  phone_number               String?                     @unique
  street_address             String?
  city                       String?
  state                      String?
  country                    String?
  created_at                 DateTime                    @default(now())
  updated_at                 DateTime                    @updatedAt
  deleted_at                 DateTime?
  organization_id            String?
  fcmToken                   String?
  accounts                   Account[]
  chat_members               ChatMember[]
  emergency_contact          EmergencyContact?
  leave_applications         LeaveApplication[]
  loan_applications          LoanApplication[]
  Message                    Message[]
  notification_recipients    NotificationRecipients[]    @relation("RecipientUser")
  notification_senders       NotificationRecipients[]    @relation("SenderUser")
  approved_payrolls          Payroll[]
  performance_review_created PerformanceReview[]         @relation("CreatedBy")
  reviewed_reviews           PerformanceReview[]         @relation("ReviewedBy")
  reviewer_reviews           PerformanceReview[]         @relation("Reviewer")
  created_templates          PerformanceReviewTemplate[] @relation("CreatedTemplates")
  approved_policy_procedure  PolicyAndProcedure[]        @relation("ApprovedPolicies")
  created_policy_procedure   PolicyAndProcedure[]        @relation("CreatedPolicies")
  preferences                Preference[]
  staffProfile               StaffProfile[]
  staff_tasks                StaffTask[]
  tasks                      Task[]                      @relation("TaskCreator")
  TimeOff                    TimeOff[]
  roles                      UserRole[]
  organization               Organization?               @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  events                     Event[]                     @relation("EventToUser")

  @@map("users")
}

model StaffRole {
  id              String         @id @default(uuid())
  active          Boolean        @default(true)
  description     String         @unique
  organization_id String?
  created_at      DateTime       @default(now())
  updated_at      DateTime       @updatedAt
  deleted_at      DateTime?
  staff_profile   StaffProfile[]
  organization    Organization?  @relation(fields: [organization_id], references: [id], onDelete: Cascade)

  @@map("staff_roles")
}

model StaffProfile {
  id                   String              @id @default(uuid())
  user_id              String              @unique
  tin                  String?             @unique
  nin                  String?             @unique
  active               Boolean             @default(true)
  email                String?             @unique
  date_of_birth        DateTime?
  bank_account_no      String?             @unique
  bank_name            String?
  passport_number      String?             @unique
  status               String?             @default("Active")
  passport_expiry_date DateTime?
  marital_status       String?
  profile_picture_url  String?
  position             String?
  skill                String?
  department           String?
  joined_at            DateTime?
  salary_basis         String?
  amount_per_month     Int?
  effective_date       DateTime?
  payment_type         String?
  team_designation_id  String?
  created_at           DateTime            @default(now())
  updated_at           DateTime            @updatedAt
  deleted_at           DateTime?
  organization_id      String?
  payroll_template_id  String?
  staffRoleId          String?
  number_of_loans      Int?                @default(0)
  is_head_of_dept      Boolean?            @default(false)
  bank_account_name    String?
  bank_id              String?             @unique
  documents_url        Json?
  contracts            Contract[]
  payrolls             Payroll[]
  performance_reviews  PerformanceReview[]
  bank                 Bank?               @relation(fields: [bank_id], references: [id])
  organization         Organization?       @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  payroll_template     PayrollTemplate?    @relation(fields: [payroll_template_id], references: [id], onDelete: Cascade)
  StaffRole            StaffRole?          @relation(fields: [staffRoleId], references: [id])
  team_designation     TeamDesignation?    @relation(fields: [team_designation_id], references: [id], onDelete: Cascade)
  user                 User                @relation(fields: [user_id], references: [id], onDelete: Cascade)
  time_offs            TimeOff[]
  work_history         WorkHistory[]

  @@map("staff_profiles")
}

model WorkHistory {
  id               String       @id @default(uuid())
  staff_profile_id String
  job_title        String
  company_industry String?
  company_name     String?
  responsibilities String
  start_date       DateTime?
  end_date         DateTime?
  created_at       DateTime     @default(now())
  updated_at       DateTime     @updatedAt
  deleted_at       DateTime?
  staffProfile     StaffProfile @relation(fields: [staff_profile_id], references: [id], onDelete: Cascade)

  @@map("work_histories")
}

model Contract {
  id                String           @id @default(uuid())
  status            String           @default("pending")
  staff_profile_id  String
  template_id       String
  name              String
  type              String?
  details           Json
  file              String?
  organization_id   String?
  created_at        DateTime         @default(now())
  updated_at        DateTime         @updatedAt
  deleted_at        DateTime?
  accepted          Boolean          @default(false)
  files             Json?
  contract_duration DateTime?
  sign_before       DateTime?
  organization      Organization?    @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  staff_profile     StaffProfile     @relation(fields: [staff_profile_id], references: [id], onDelete: Cascade)
  template          ContractTemplate @relation(fields: [template_id], references: [id], onDelete: Cascade)

  @@map("contracts")
}

model ContractTemplate {
  id                String        @id @default(uuid())
  details           Json
  name              String
  type              String
  organization_id   String?
  created_at        DateTime      @default(now())
  updated_at        DateTime      @updatedAt
  deleted_at        DateTime?
  contract_duration Int?
  sign_before       Int?
  versions          Json?
  organization      Organization? @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  contract          Contract[]

  @@map("contract_templates")
}

model Account {
  id           String        @id @default(uuid())
  created_at   DateTime      @default(now())
  deleted_at   DateTime?
  active       Boolean       @default(true)
  balance      Float         @default(0)
  name         String
  updated_at   DateTime      @updatedAt
  user_id      String
  user         User          @relation(fields: [user_id], references: [id], onDelete: Cascade)
  transactions Transaction[]

  @@map("accounts")
}

model Transaction {
  id          String    @id @default(uuid())
  account_id  String
  amount      Float
  description String
  type        String
  category    String
  meta_data   Json?
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
  deleted_at  DateTime?
  account     Account   @relation(fields: [account_id], references: [id], onDelete: Cascade)

  @@map("transactions")
}

model Role {
  id           String     @id @default(uuid())
  name         String     @unique
  active       Boolean    @default(true)
  display_name String     @unique
  description  String?
  created_at   DateTime   @default(now())
  updated_at   DateTime   @updatedAt
  deleted_at   DateTime?
  users        UserRole[]

  @@map("roles")
}

model UserRole {
  id         String    @id @default(uuid())
  active     Boolean   @default(true)
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  deleted_at DateTime?
  user_id    String
  role_name  String
  role       Role      @relation(fields: [role_name], references: [name], onDelete: Cascade)
  user       User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([role_name, user_id], name: "unique_user_role")
  @@map("user_roles")
}

model Organization {
  id                             String                                @id @default(uuid())
  name                           String
  slug                           String                                @unique
  token                          String                                @unique
  created_at                     DateTime                              @default(now())
  updated_at                     DateTime                              @updatedAt
  deleted_at                     DateTime?
  banks                          Bank[]
  chats                          Chat[]
  ContractTemplate               ContractTemplate[]
  Contract                       Contract[]
  events                         Event[]
  LeaveApplication               LeaveApplication[]
  LeaveSetting                   LeaveSetting[]
  LoanApplication                LoanApplication[]
  LoanRepayment                  LoanRepayment[]
  LoanSetting                    LoanSetting[]
  MessageDelivery                MessageDelivery[]
  Message                        Message[]
  PayrollTemplate                PayrollTemplate[]
  Payroll                        Payroll[]
  performance_review_assignments PerformanceReviewTemplateAssignment[]
  performance_reviews            PerformanceReview[]
  performance_review_templates   PerformanceReviewTemplate[]
  PolicyProcedure                PolicyAndProcedure[]
  preferences                    Preference[]
  StaffProfile                   StaffProfile[]
  StaffRole                      StaffRole[]
  Task                           Task[]
  accounts                       Accounts[]
  budgets                        Budget[]
  invoices                       Invoice[]
  bills                          Bill[]
  payments                       Payment[]
  bankStatements                 BankStatement[]
  expenses                       Expense[]
  expense_categories             ExpenseCategory[]
  teamDesignations               TeamDesignation[]
  teams                          Team[]
  User                           User[]

  @@map("organizations")
}

model PerformanceReviewTemplate {
  id                  String                                @id @default(uuid())
  name                String?
  type                String
  metrics             Json
  organization_id     String
  created_by_id       String
  created_at          DateTime                              @default(now())
  updated_at          DateTime                              @updatedAt
  deleted_at          DateTime?
  assignedTeams       PerformanceReviewTemplateAssignment[]
  performance_reviews PerformanceReview[]
  created_by          User                                  @relation("CreatedTemplates", fields: [created_by_id], references: [id], onDelete: Cascade)
  organization        Organization                          @relation(fields: [organization_id], references: [id], onDelete: Cascade)

  @@map("performance_templates")
}

model PerformanceReviewTemplateAssignment {
  id              String                    @id @default(uuid())
  template_id     String
  team_id         String?
  created_at      DateTime                  @default(now())
  updated_at      DateTime                  @updatedAt
  deleted_at      DateTime?
  organization_id String?
  role_level      Int?                      @default(1)
  role_level_max  Int?
  role_level_min  Int?
  organization    Organization?             @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  team            Team?                     @relation(fields: [team_id], references: [id], onDelete: Cascade)
  template        PerformanceReviewTemplate @relation(fields: [template_id], references: [id], onDelete: Cascade)

  @@map("performance_review_template_assignments")
}

model PerformanceReview {
  id              String                    @id @default(uuid())
  template_id     String
  team_id         String?
  staff_id        String
  reviewer_id     String
  created_by      String
  organization_id String
  completed_at    DateTime?
  score           Float?
  feedback        Json?
  created_at      DateTime                  @default(now())
  updated_at      DateTime                  @updatedAt
  deleted_at      DateTime?
  reviewed_by_id  String?
  createdBy       User                      @relation("CreatedBy", fields: [created_by], references: [id], onDelete: Cascade)
  organization    Organization              @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  reviewed_by     User?                     @relation("ReviewedBy", fields: [reviewed_by_id], references: [id], onDelete: Cascade)
  reviewer        User                      @relation("Reviewer", fields: [reviewer_id], references: [id], onDelete: Cascade)
  staff           StaffProfile              @relation(fields: [staff_id], references: [id], onDelete: Cascade)
  team            Team?                     @relation(fields: [team_id], references: [id])
  template        PerformanceReviewTemplate @relation(fields: [template_id], references: [id], onDelete: Cascade)

  @@map("performance_reviews")
}

model TimeOff {
  id               String       @id @default(uuid())
  staff_profile_id String
  duration         Int
  start_date       DateTime
  end_date         DateTime
  description      String
  meta_data        Json?
  approved_by      String?
  approved_at      DateTime?
  status           String       @default("pending")
  created_at       DateTime     @default(now())
  updated_at       DateTime     @updatedAt
  deleted_at       DateTime?
  approver         User?        @relation(fields: [approved_by], references: [id], onDelete: Cascade)
  staff_profile    StaffProfile @relation(fields: [staff_profile_id], references: [id], onDelete: Cascade)

  @@map("time_offs")
}

model PayrollTemplate {
  id              String         @id @default(uuid())
  organization_id String
  name            String
  data            Json?
  created_at      DateTime       @default(now())
  updated_at      DateTime       @updatedAt
  deleted_at      DateTime?
  organization    Organization   @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  payrolls        Payroll[]
  staff           StaffProfile[]

  @@map("payroll_templates")
}

model Payroll {
  id              String          @id @default(uuid())
  organization_id String?
  data            Json?
  month           DateTime
  approved        Boolean         @default(false)
  approved_by_id  String?
  generated       Boolean         @default(false)
  batch           String?         @unique
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt
  deleted_at      DateTime?
  status          String          @default("pending")
  approval_status String?         @default("not_approved")
  staff_id        String
  template_id     String
  approved_by     User?           @relation(fields: [approved_by_id], references: [id])
  organization    Organization?   @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  staff           StaffProfile    @relation(fields: [staff_id], references: [id], onDelete: Cascade)
  template        PayrollTemplate @relation(fields: [template_id], references: [id], onDelete: Cascade)

  @@map("payrolls")
}

model LeaveSetting {
  id                String             @id @default(uuid())
  name              String
  type              String
  duration          Int
  applicable_to     String
  created_at        DateTime           @default(now())
  updated_at        DateTime           @updatedAt
  deleted_at        DateTime?
  organization_id   String?
  role_level        Int?               @default(0)
  leave_application LeaveApplication[]
  organization      Organization?      @relation(fields: [organization_id], references: [id], onDelete: Cascade)

  @@map("leave_settings")
}

model LeaveApplication {
  id               String        @id @default(uuid())
  user_id          String
  leave_setting_id String
  start_date       DateTime
  end_date         DateTime
  status           String
  reason           String?
  reviewed_by      String?
  reviewed_at      DateTime?
  created_at       DateTime      @default(now())
  updated_at       DateTime      @updatedAt
  deleted_at       DateTime?
  organization_id  String?
  approval_level   Json?
  leave_setting    LeaveSetting  @relation(fields: [leave_setting_id], references: [id], onDelete: Cascade)
  organization     Organization? @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  user             User          @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("leave_applications")
}

model LoanSetting {
  id                   String        @id @default(uuid())
  max_percentage       Float
  max_repayment_months Int
  created_at           DateTime      @default(now())
  updated_at           DateTime      @updatedAt
  deleted_at           DateTime?
  organization_id      String?
  number_of_times      Int?          @default(0)
  organization         Organization? @relation(fields: [organization_id], references: [id], onDelete: Cascade)

  @@map("loan_settings")
}

model LoanApplication {
  id                String          @id @default(uuid())
  user_id           String
  amount            Float
  status            String
  reason            String?
  repayment_period  Int
  monthly_deduction Float?
  reviewed_by       String?
  reviewed_at       DateTime?
  created_at        DateTime        @default(now())
  updated_at        DateTime        @updatedAt
  deleted_at        DateTime?
  organization_id   String?
  is_disbursed      Boolean         @default(false)
  fully_paid        Boolean         @default(false)
  approval_level    Json?
  organization      Organization?   @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  user              User            @relation(fields: [user_id], references: [id], onDelete: Cascade)
  loan_repayments   LoanRepayment[]

  @@map("loan_applications")
}

model LoanRepayment {
  id                String          @id @default(uuid())
  loan_id           String
  repayment_date    DateTime
  amount_paid       Float
  balance_remaining Float
  created_at        DateTime        @default(now())
  updated_at        DateTime        @updatedAt
  deleted_at        DateTime?
  organization_id   String?
  payment_method    String
  remarks           String?
  loan              LoanApplication @relation(fields: [loan_id], references: [id], onDelete: Cascade)
  organization      Organization?   @relation(fields: [organization_id], references: [id], onDelete: Cascade)

  @@map("loan_repayments")
}

model Team {
  id                                  String                                @id @default(uuid())
  name                                String
  description                         String?
  parent_team_id                      String?
  organization_id                     String
  created_at                          DateTime                              @default(now())
  updated_at                          DateTime                              @updatedAt
  deleted_at                          DateTime?
  PerformanceReviewTemplateAssignment PerformanceReviewTemplateAssignment[]
  PerformanceReview                   PerformanceReview[]
  policy_procedure                    PolicyAndProcedure[]
  designations                        TeamDesignation[]
  organization                        Organization                          @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  parentTeam                          Team?                                 @relation("TeamHierarchy", fields: [parent_team_id], references: [id])
  childTeams                          Team[]                                @relation("TeamHierarchy")

  @@map("teams")
}

model Designation {
  id               String            @id @default(uuid())
  name             String
  description      String?
  quantity         Int
  job_description  String?
  created_at       DateTime          @default(now())
  updated_at       DateTime          @updatedAt
  deleted_at       DateTime?
  role_level       Int?              @default(1)
  teamDesignations TeamDesignation[]

  @@map("designations")
}

model TeamDesignation {
  id                   String         @id @default(uuid())
  team_id              String
  designation_id       String
  quantity             Int?
  vacancies            Int?
  organization_id      String
  team_job_description String?
  created_at           DateTime       @default(now())
  updated_at           DateTime       @updatedAt
  deleted_at           DateTime?
  staffs               StaffProfile[]
  designation          Designation    @relation(fields: [designation_id], references: [id], onDelete: Cascade)
  organization         Organization   @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  team                 Team           @relation(fields: [team_id], references: [id], onDelete: Cascade)

  @@unique([team_id, designation_id])
  @@map("team_designations")
}

enum REPEAT {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
  NONE
}

model Event {
  id               String       @id @default(uuid())
  name             String
  description      String?
  link             String?
  location         String?
  all_day          Boolean      @default(false)
  save_to_calendar Boolean      @default(false)
  repeat           REPEAT?
  starts           DateTime
  ends             DateTime
  organization_id  String
  type             String
  created_at       DateTime     @default(now())
  updated_at       DateTime     @updatedAt
  deleted_at       DateTime?
  organization     Organization @relation(fields: [organization_id], references: [id])
  users            User[]       @relation("EventToUser")

  @@map("events")
}

enum MessageChannel {
  INTERNAL
  WHATSAPP
  EMAIL
  SMS
}

enum MessageStatus {
  DRAFT
  QUEUED
  SENT
  DELIVERED
  READ
  FAILED
}

enum MessageType {
  TEXT
  IMAGE
  FILE
  AUDIO
  VIDEO
  SYSTEM
}

model MessageDelivery {
  id              String         @id @default(cuid())
  message_id      String
  channel         MessageChannel
  status          MessageStatus  @default(QUEUED)
  external_id     String?
  sent_at         DateTime?
  delivered_at    DateTime?
  error           String?
  metadata        Json?
  organization_id String
  message         Message        @relation(fields: [message_id], references: [id])
  organization    Organization   @relation(fields: [organization_id], references: [id])

  @@unique([message_id, channel])
  @@map("message_deliveries")
}

model Message {
  id              String            @id @default(cuid())
  content         Json
  created_at      DateTime          @default(now())
  updated_at      DateTime          @updatedAt
  sender_id       String
  chat_id         String?
  deleted_at      DateTime?
  message_type    MessageType       @default(TEXT)
  organization_id String
  read            Boolean           @default(false)
  deliveries      MessageDelivery[]
  chat            Chat?             @relation("ChatMessages", fields: [chat_id], references: [id])
  organization    Organization      @relation(fields: [organization_id], references: [id])
  sender          User              @relation(fields: [sender_id], references: [id])

  @@map("messages")
}

enum ChatRole {
  ADMIN
  MEMBER
}

enum ChatType {
  DIRECT
  GROUP
  BROADCAST
  COMPLAINT
  FEEDBACK
}

enum ChatStatus {
  DRAFT
  ACTIVE
  OPEN
  RESOLVED
}

model Chat {
  id              String       @id @default(cuid())
  name            String?
  type            ChatType     @default(DIRECT)
  status          ChatStatus   @default(DRAFT)
  created_at      DateTime     @default(now())
  updated_at      DateTime     @updatedAt
  deleted_at      DateTime?
  organization_id String
  members         ChatMember[]
  organization    Organization @relation(fields: [organization_id], references: [id])
  messages        Message[]    @relation("ChatMessages")

  @@map("chats")
}

model ChatMember {
  id        String   @id @default(cuid())
  user_id   String
  chat_id   String
  joined_at DateTime @default(now())
  role      ChatRole @default(MEMBER)
  chat      Chat     @relation(fields: [chat_id], references: [id])
  user      User     @relation(fields: [user_id], references: [id])

  @@unique([user_id, chat_id])
  @@map("chat_members")
}

model Notification {
  id                String                   @id @default(cuid())
  notification_type String?
  title             String?
  message           String?
  deleted_at        DateTime?
  created_at        DateTime                 @default(now())
  status            String                   @default("pending")
  is_read           Boolean                  @default(false)
  priority          Int                      @default(3)
  source_type       String?
  action_url        String?
  expires_at        DateTime?
  additional_data   Json?
  sent_at           DateTime?
  recipients        NotificationRecipients[]

  @@map("notifications")
}

model NotificationRecipients {
  id              String       @id @default(cuid())
  recipient_id    String
  notification_id String
  is_admin        Boolean      @default(false)
  sender_id       String?
  is_sender       Boolean      @default(false)
  notification    Notification @relation(fields: [notification_id], references: [id])
  recipient       User         @relation("RecipientUser", fields: [recipient_id], references: [id])
  sender          User?        @relation("SenderUser", fields: [sender_id], references: [id])

  @@unique([recipient_id, notification_id])
  @@map("notification_recipients")
}

enum PnPStatus {
  DRAFT // Policy/Procedure is still a draft
  PUBLISHED // Policy/Procedure is published
}

model PolicyAndProcedure {
  id                     String        @id @default(uuid())
  title                  String
  content                String
  status                 PnPStatus     @default(DRAFT)
  organization_id        String?
  team_id                String?
  is_approved            Boolean       @default(false)
  created_by             String
  approved_by            String?
  created_at             DateTime      @default(now())
  updated_at             DateTime      @updatedAt
  deleted_at             DateTime?
  year_validity_duration Int?          @default(1)
  approvedBy             User?         @relation("ApprovedPolicies", fields: [approved_by], references: [id])
  createdBy              User          @relation("CreatedPolicies", fields: [created_by], references: [id], onDelete: Cascade)
  organization           Organization? @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  team                   Team?         @relation(fields: [team_id], references: [id], onDelete: Cascade)

  @@map("policies_and_procedures")
}

model Bank {
  id              String        @id @default(cuid())
  name            String
  sort_code       String?
  organization_id String
  created_at      DateTime      @default(now())
  deleted_at      DateTime?
  updated_at      DateTime      @updatedAt
  organization    Organization  @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  staff           StaffProfile?

  @@unique([name, organization_id])
  @@map("banks")
}

model Preference {
  id              String        @id @default(uuid())
  organization_id String?
  user_id         String?
  name            String
  value           Json
  status          String        @default("new")
  created_at      DateTime      @default(now())
  updated_at      DateTime      @updatedAt
  organization    Organization? @relation(fields: [organization_id], references: [id])
  user            User?         @relation(fields: [user_id], references: [id])

  @@unique([name, organization_id, user_id])
  @@index([name, organization_id, user_id])
  @@map("preferences")
}

model EmergencyContact {
  id             String    @id @default(uuid())
  active         Boolean   @default(true)
  name           String
  phone          String
  relationship   String
  user_id        String?   @unique
  street_address String
  city           String
  state          String
  country        String
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt
  deleted_at     DateTime?
  user           User?     @relation(fields: [user_id], references: [id])

  @@index([deleted_at, active])
  @@map("emergency_contacts")
}

model Task {
  id                     String       @id @default(uuid())
  title                  String
  description            String
  created_by_id          String
  organization_id        String
  is_repeated            Boolean      @default(false)
  start_date             DateTime?
  end_date               DateTime?
  instructions           Json?
  task_repeat_time_table Json?
  created_at             DateTime     @default(now())
  updated_at             DateTime?    @updatedAt
  deleted_at             DateTime?
  staff_tasks            StaffTask[]
  created_by_user        User         @relation("TaskCreator", fields: [created_by_id], references: [id])
  organization           Organization @relation(fields: [organization_id], references: [id])

  @@map("tasks")
}

model StaffTask {
  id                     String    @id @default(uuid())
  task_id                String
  status                 String    @default("pending")
  created_at             DateTime  @default(now())
  updated_at             DateTime? @updatedAt
  deleted_at             DateTime?
  is_completed           Boolean   @default(false)
  task_repeat_time_table Json?
  instructions           Json?
  staff_feedback         Json?
  user_id                String
  task                   Task      @relation(fields: [task_id], references: [id])
  user                   User      @relation(fields: [user_id], references: [id])

  @@map(name: "staff_tasks")
}

enum TransactionType {
  INFLOW
  OUTFLOW
}

model Accounts {
  id              String    @id @default(cuid())
  account_name    String
  account_type_enum AccountTypeEnum  @default(INCOME)
  account_code    String
  description     String?
  // New fields for bank accounts
  account_number  String?
  bank_name       String?
  bank_branch     String?
  swift_code      String?
  routing_number  String?
  is_default      Boolean   @default(false)
  
  total_amount    Float     @default(0)
  organization_id String
  organization    Organization @relation(fields: [organization_id], references: [id])
  parent_id       String?
  parent_account  Accounts?  @relation("AccountHierarchy", fields: [parent_id], references: [id])
  sub_accounts    Accounts[] @relation("AccountHierarchy")
  account_items   AccountItem[]
  invoices        Invoice[] @relation(name: "AccountInvoices")
  bills           Bill[]    @relation(name: "AccountBills")
  bank_statements BankStatement[] @relation(name: "AccountBankStatements")
  // Track payments made to/from this account
  payments_received Payment[] @relation("AccountPayments")
  budget          Budget?   @relation(name: "BudgetExpenseAccount")
  created_at      DateTime  @default(now())
  deleted_at      DateTime?

  @@unique([organization_id, account_name], name: "unique_account")
  @@map(name: "accountss")
}

enum AccountTypeEnum {
  ASSET
  LIABILITY
  EQUITY
  INCOME
  EXPENSE
  BANK
  LOAN
  CREDIT_CARD
  FIXED_ASSET
 
}

model Budget {
  id                 String        @id @default(uuid())
  name               String
  budgeted_amount    Float
  amount_spent       Float
  balance            Float
  status             BudgetStatus  @default(NOT_APPROVED)
  organization_id    String
  organization       Organization   @relation(fields: [organization_id], references: [id])
  items              AccountItem[]
  expense_account_id String?       @unique
  expense_account    Accounts?      @relation("BudgetExpenseAccount", fields: [expense_account_id], references: [id])
  created_at         DateTime      @default(now())
  updated_at         DateTime?     @updatedAt
  deleted_at         DateTime?

  @@map(name: "budgets")
}

//Note that we are using this as the general Line Item Table
model AccountItem {
  id              String    @id @default(uuid())
  item_code       String    @default("100001")
  description     String
  budgeted_amount Float     @default(0)
  quantity        Int       @default(1)
  price           Float?
  amount          Float
  paid_in_by      String?
  assign_to       String?
  account_id      String?
  invoice_id      String?
  invoice         Invoice?  @relation(fields: [invoice_id], references: [id])
  bill_id         String?
  bill            Bill?     @relation(fields: [bill_id], references: [id])
  date            DateTime
  account         Accounts?  @relation(fields: [account_id], references: [id])
  budget_id       String?   @unique
  budget          Budget?   @relation(fields: [budget_id], references: [id])
  payment         Payment?  @relation(name: "PaymentAccountItem")
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt
  deleted_at      DateTime?

  @@map(name: "account_items")
}

enum BudgetStatus {
  APPROVED
  NOT_APPROVED
}


enum PaymentMethod {
  CASH
  BANK_TRANSFER
  CARD
  CHEQUE    
}

enum BillStatus {
  DRAFT
  RECEIVED
  PAID
  PARTIALLY_PAID
  OVERDUE
  VOID
  PENDING
}
enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  PARTIALLY_PAID
  OVERDUE
  VOID
  PENDING
}
model Invoice {

  id              String    @id @default(cuid())
  invoice_number  String    @unique
  account_id      String?    // Income account
  account         Accounts?   @relation(fields: [account_id], references: [id], name: "AccountInvoices")
  customer_name   String
  customer_id     String?   // Optional customer reference
  amount          Float
  amount_paid     Float     @default(0)
  balance_due     Float     @default(0)
  due_date        DateTime
  status          InvoiceStatus
  organization_id String
  organization    Organization @relation(fields: [organization_id], references: [id])
  account_items   AccountItem[]
  payments        Payment[]
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt
  deleted_at      DateTime?

}

model Bill {

  id              String    @id @default(cuid())
  bill_number     String    @unique
  account_id      String?    // Expense account
  account         Accounts?   @relation(fields: [account_id], references: [id], name: "AccountBills")
  vendor_name     String
  vendor_id       String?   // Optional vendor reference
  amount          Float
  amount_paid     Float     @default(0)
  balance_due     Float     @default(0)
  due_date        DateTime
  status          BillStatus
  organization_id String
  organization    Organization @relation(fields: [organization_id], references: [id])
  account_items   AccountItem[]
  payments        Payment[]
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt
  deleted_at      DateTime?

}

model Payment {

  id              String    @id @default(cuid())
  amount          Float
  payment_date    DateTime
  payment_method  PaymentMethod
  reference       String?
  bank_reference String?   // For matching with bank transactions
  description     String?
  transaction_type TransactionType
  reconciliation_date DateTime?
  reconciliation_batch String?
  // Link to source/destination account(bank)
  account_id      String?
  account         Accounts?  @relation("AccountPayments", fields: [account_id], references: [id])
  // Optional links to related records
  invoice_id      String?
  invoice         Invoice?  @relation(fields: [invoice_id], references: [id])
  bill_id         String?
  bill            Bill?     @relation(fields: [bill_id], references: [id])
  // Link to account item for detailed tracking
  account_item_id String? @unique
  account_item    AccountItem? @relation(name: "PaymentAccountItem", fields: [account_item_id], references: [id])
  organization_id String
  organization    Organization @relation(fields: [organization_id], references: [id])
  bank_statement_transaction BankStatementTransaction? @relation(name: "matched_payment")
  created_at      DateTime  @default(now())
  reconciled      Boolean   @default(false)
}

model BankStatement {
  id              String    @id @default(cuid())
  account_id      String    // Reference to bank account
  account         Accounts   @relation(fields: [account_id], references: [id], name: "AccountBankStatements")
  statement_date  DateTime  // Month/Year of statement
  file_url        String    // URL to stored PDF
  status          ReconciliationStatus
  opening_balance Float
  closing_balance Float
  organization_id String
  organization    Organization @relation(fields: [organization_id], references: [id])
  transactions    BankStatementTransaction[]
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt
  deleted_at      DateTime?
}

model BankStatementTransaction {
  id                String    @id @default(cuid())
  statement_id      String
  statement         BankStatement @relation(fields: [statement_id], references: [id])
  transaction_date  DateTime
  description       String
  reference         String?
  amount           Float
  transaction_type TransactionType
  bank_reference   String?   // For bank-specific transaction codes
  transaction_code String?   // For standardized transaction categorization
  matched_payment_id String?  @unique
  matched_payment   Payment?  @relation(name: "matched_payment", fields: [matched_payment_id], references: [id])
  reconciled        Boolean   @default(false)
  reconciliation_date DateTime?
  reconciliation_batch String?
  notes             String?
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt

  @@index([transaction_date])
  @@index([bank_reference])
  @@index([reconciliation_batch])
  @@index([reconciled, transaction_date])
}

enum ReconciliationStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  ERROR
}

model Expense {
  id              String          @id @default(uuid())
  organization_id String
  line_items      Json
  amount          Float
  description     String
  category_id     String
  created_by      String
  approved_by     String?
  disbursed_at    DateTime?
  approved_at     DateTime?
  status          String
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt
  deleted_at      DateTime?
  organization    Organization     @relation(fields: [organization_id], references: [id])
  category        ExpenseCategory @relation(fields: [category_id], references: [id])

  @@map("expenses")
}

model ExpenseCategory {
  id              String      @id @default(uuid())
  organization_id String
  name            String
  description     String
  created_at      DateTime    @default(now())
  updated_at      DateTime    @updatedAt
  deleted_at      DateTime?
  organization    Organization @relation(fields: [organization_id], references: [id])
  expenses        Expense[]

  @@map("expense_categories")
}
